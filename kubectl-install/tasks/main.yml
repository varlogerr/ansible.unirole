---
- block:
  - name: add apt-key
    apt_key:
      url: "https://packages.cloud.google.com/apt/doc/apt-key.gpg"
      state: present

  - name: add ppa
    apt_repository:
      repo: "deb https://apt.kubernetes.io/ kubernetes-xenial main"
      filename: kubernetes
      state: present

  - name: install kubectl
    apt: name=kubectl state=latest
    register: _kubectl_installed_result

  - name: create autocomplete
    shell: "kubectl completion bash > {{ kubctl_autocomplete_path }}"
    when: _kubectl_installed_result.changed
  become: true
